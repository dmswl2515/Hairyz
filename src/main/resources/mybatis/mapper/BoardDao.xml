<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.study.springboot.dao.IBoardDao">

	<insert id="insertPost" parameterType="com.study.springboot.dto.BoardDto" useGeneratedKeys="true" keyProperty="bd_no"  keyColumn="BD_NO">
	    INSERT INTO board 
    	  (bd_no, bd_cate, mb_id, bd_writer, bd_title, bd_content, bd_date, 
    	  	bd_imgpath, bd_orgname, bd_modname, bd_state)
	    VALUES 
    	  (board_seq.NEXTVAL, #{bd_cate, jdbcType=CHAR}, #{mb_id, jdbcType=VARCHAR}, #{bd_writer, jdbcType=VARCHAR}, #{bd_title, jdbcType=VARCHAR}, #{bd_content, jdbcType=VARCHAR}, SYSDATE, 
    	  	#{bd_imgpath, jdbcType=VARCHAR}, #{bd_orgname, jdbcType=VARCHAR}, #{bd_modname, jdbcType=VARCHAR}, 'Y')
	</insert>
	
	<select id="getPostView" parameterType="int" resultType="BoardDto">
	    SELECT * FROM board
        WHERE bd_no = #{bd_no} AND bd_state = 'Y'
	</select>
	
	<!-- 게시글 조회수 증가 -->
    <update id="upHit" parameterType="int">
        UPDATE board
           SET bd_hit = bd_hit + 1
         WHERE bd_no = #{bd_no}
    </update>
	
	<!-- 좋아요 추가 -->
    <insert id="insertLike">
        INSERT INTO likes (lk_no, mb_id, bd_no, lk_date)
        VALUES (likes_seq.NEXTVAL, #{userId, jdbcType=VARCHAR}, #{boardId}, SYSDATE)
    </insert>

    <!-- 좋아요 삭제 -->
    <delete id="deleteLike">
        DELETE FROM likes WHERE mb_id = #{userId, jdbcType=VARCHAR} AND bd_no = #{boardId}
    </delete>

    <!-- 특정 게시글의 좋아요 수 조회 -->
    <select id="getLikeCount" resultType="int">
        SELECT COUNT(*) FROM likes WHERE bd_no = #{boardId}
    </select>

    <!-- 사용자가 특정 게시글에 대해 이미 좋아요를 눌렀는지 확인 -->
    <select id="checkUserLike" resultType="int">
        SELECT COUNT(*) FROM likes WHERE mb_id = #{userId, jdbcType=VARCHAR} AND bd_no = #{boardId}
    </select>
    
    <delete id="deletePost" parameterType="int">
        UPDATE board SET bd_state = 'N' WHERE bd_no = #{bd_no}
    </delete>
    
    <!-- 수정할 게시글 조회 -->
    <select id="getPostById" parameterType="int" resultType="com.study.springboot.dto.BoardDto">
        SELECT * FROM board WHERE bd_no = #{bd_no}
    </select>
    
    <!-- 게시글 수정 -->
    <update id="updatePost" parameterType="com.study.springboot.dto.BoardDto">
        UPDATE board
        SET bd_title = #{bd_title, jdbcType=VARCHAR},
            bd_content = #{bd_content, jdbcType=VARCHAR},
            bd_cate = #{bd_cate, jdbcType=CHAR},
            bd_orgname = #{bd_orgname, jdbcType=VARCHAR},  <!-- 파일 이름 -->
            bd_modname = #{bd_modname, jdbcType=VARCHAR}   <!-- 시스템 파일 이름 -->
        WHERE bd_no = #{bd_no}
    </update>
	
</mapper>